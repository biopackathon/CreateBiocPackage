<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bioconductorパッケージの作り方 • CreateBiocPackage</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bioconductorパッケージの作り方">
<meta property="og:description" content="CreateBiocPackage">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CreateBiocPackage</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/workshop.html">Bioconductorパッケージの作り方</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/biopackathon/CreateBiocPackage">
    <span class="fas fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="workshop_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bioconductorパッケージの作り方</h1>
                        <h4 class="author">Kozo Nishida, Saskia Freytag &amp; Peter Hickey</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/seandavi/BuildABiocWorkshop/blob/master/vignettes/workshop.Rmd"><code>vignettes/workshop.Rmd</code></a></small>
      <div class="hidden name"><code>workshop.Rmd</code></div>

    </div>

    
    
<div id="bioconductorパッケージの作り方" class="section level1">
<h1 class="hasAnchor">
<a href="#bioconductor%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9" class="anchor"></a>Bioconductorパッケージの作り方</h1>
<p>免責事項: この教材のほとんどは Saskia Freytag さん Peter Hickey さん による 英語ワークショップ <a href="https://saskiafreytag.github.io/making_bioconductor_pkg/articles/workshop.html">Building a Bioconductor Package</a> に基づいています。(それをKozo Nishidaが日本語訳したものになります。)</p>
<div id="概要" class="section level2">
<h2 class="hasAnchor">
<a href="#%E6%A6%82%E8%A6%81" class="anchor"></a>概要</h2>
<div id="説明" class="section level3">
<h3 class="hasAnchor">
<a href="#%E8%AA%AC%E6%98%8E" class="anchor"></a>説明</h3>
<p>ここでは</p>
<ol style="list-style-type: decimal">
<li>Bioconductorパッケージがどのようなものか</li>
<li>なぜBioconductorパッケージを作るのか</li>
<li>どのようにしてBioconductorパッケージを作るのか</li>
</ol>
<p>を伝えます。 この教材はTogoTVの…用のテキスト版になります。</p>
</div>
<div id="必要条件" class="section level3">
<h3 class="hasAnchor">
<a href="#%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6" class="anchor"></a>必要条件</h3>
<ul>
<li>R言語の基本的な知識</li>
<li>RとRStudio</li>
<li>GitHubのアカウント</li>
</ul>
</div>
<div id="聴講者は何ができるようになるか" class="section level3">
<h3 class="hasAnchor">
<a href="#%E8%81%B4%E8%AC%9B%E8%80%85%E3%81%AF%E4%BD%95%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%8B" class="anchor"></a>聴講者は何ができるようになるか</h3>
<p>バージョン管理された小さなRパッケージを作る方法を習得できます。</p>
</div>
<div id="習得に要する時間の概要" class="section level3">
<h3 class="hasAnchor">
<a href="#%E7%BF%92%E5%BE%97%E3%81%AB%E8%A6%81%E3%81%99%E3%82%8B%E6%99%82%E9%96%93%E3%81%AE%E6%A6%82%E8%A6%81" class="anchor"></a>習得に要する時間の概要</h3>
<p>An example for a ??-minute workshop:</p>
<table class="table">
<thead><tr class="header">
<th>Activity</th>
<th>Time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>???</td>
<td>15m</td>
</tr>
<tr class="even">
<td>???</td>
<td>15m</td>
</tr>
<tr class="odd">
<td>???</td>
<td>5m</td>
</tr>
<tr class="even">
<td>???</td>
<td>10m</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="何を何故いつどのようにして" class="section level2">
<h2 class="hasAnchor">
<a href="#%E4%BD%95%E3%82%92%E4%BD%95%E6%95%85%E3%81%84%E3%81%A4%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%A6" class="anchor"></a>何を、何故、いつ、どのようにして</h2>
<div id="bioconductorパッケージとは何か" class="section level3">
<h3 class="hasAnchor">
<a href="#bioconductor%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B" class="anchor"></a>Bioconductorパッケージとは何か?</h3>
<p>Bioconductorパッケージとはハイスループットゲノムデータの分析と理解のための Rパッケージ集です。 またそれらのパッケージリポジトリはCRANとは別のところにあります。 Bioconductorパッケージは、「あなた以外の人達と情報を共有するため」の 「コード」「データ」「ドキュメント」および「テスト」を合わせて提供します。</p>
<p>Bioconductorパッケージには大まかに言って3つのタイプがあります。</p>
<ul>
<li>Annotation: 何らかのIDを他の情報にリンクする情報を提供するデータベース のようなパッケージ</li>
<li>Software: アルゴリズムの実装、データベースへのアクセス、データの可視化など を提供するパッケージ</li>
<li>Experiment data: Softwareパッケージの用例を説明するために使用される データセットを提供するパッケージ</li>
</ul>
<p>この教材では、Softwareパッケージのみの説明を行います。</p>
</div>
<div id="何故bioconductorパッケージを作るのか" class="section level3">
<h3 class="hasAnchor">
<a href="#%E4%BD%95%E6%95%85bioconductor%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%9C%E3%82%8B%E3%81%AE%E3%81%8B" class="anchor"></a>何故Bioconductorパッケージを作るのか?</h3>
<p>Bioconductorパッケージは ハイスループットゲノムデータの分析と理解に関連するRコードとドキュメントを 配布する簡単な方法を提供します。 Bioconductorのリポジトリにあるパッケージは 複数のシステム(Windows, macOS, Linux)で定期的にビルド、インストール、テスト されるため、インストール可能であることが保証されています。 また、高品質で、適切に保守され、利用方法が完全に文書化されていることが 義務付けられています。 このようなパッケージを作成し、Bioconductorを介して利用できるようにすることで、 あなたは「オープンサイエンス」に貢献することができます。 「オープンサイエンス」は、ソフトウェアを含む科学的プロセスのすべての面に アクセスできるようにすることを目的とした運動です。 これにより、再現性のある研究が保証され、作業の無駄な繰り返しが減り、 研究の効率が向上します。</p>
<p>前述は少し高尚な理由ですが、Bioconductorのパッケージ作者になることは あなたのキャリアにも良いです。 Bioconductorパッケージは他の科学者が使いやすい形になっているので、 あなたの仕事の範囲を広げ、重要性(引用数)を高めるでしょう。</p>
</div>
<div id="いつbioconductorパッケージを作るべきか" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%81%84%E3%81%A4bioconductor%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%9C%E3%82%8B%E3%81%B9%E3%81%8D%E3%81%8B" class="anchor"></a>いつBioconductorパッケージを作るべきか?</h3>
<p>「ハイスループットゲノムデータの分析または理解における1つまたは複数の問題に 対処する一連のまとまりのある関数がある」なら あなたはBioconductorパッケージを作る準備ができています。 その関数は単に既存のソリューションの代替を提示するだけでなく、 何らかの進歩を持っていることが重要です。 ただし、アイデアがすでに実装されている場合でも、がっかりしないでください。 そのような場合は、あなたのアイデアを実装しているパッケージの作者にアプローチし、 コラボレーションを提案することを検討してください。</p>
</div>
<div id="どのようにしてbioconductorパッケージを作るのか" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%81%A6bioconductor%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%9C%E3%82%8B%E3%81%AE%E3%81%8B" class="anchor"></a>どのようにしてBioconductorパッケージを作るのか?</h3>
<p>通常のRパッケージにBioconductorで必要とされることを加味して作ります。 この具体的な内容は、本テキストの残りの部分で述べます。</p>
</div>
</div>
<div id="bioconductor-パッケージの設計原理" class="section level2">
<h2 class="hasAnchor">
<a href="#bioconductor-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%A8%AD%E8%A8%88%E5%8E%9F%E7%90%86" class="anchor"></a>Bioconductor パッケージの設計原理</h2>
<div id="再利用性" class="section level3">
<h3 class="hasAnchor">
<a href="#%E5%86%8D%E5%88%A9%E7%94%A8%E6%80%A7" class="anchor"></a>再利用性</h3>
<p>現在Bioconductorには1903のSoftwareパッケージがあります。 これらパッケージの多くはよく考えられたデータ構造を実装し、 その周りにインフラを構築しています。 特に、<a href="https://bioconductor.org/about/core-team/">Bioconductor Core Team</a>は、 Bioconductorプロジェクトの中心となる十分にテストされたパッケージの設計と開発に かなりのリソースを費やしてきました。 あなたがBioconductorパッケージを作る場合、可能な限りこれらのデータ構造と インフラを活用することが重要です。 たとえば、ハイスループットゲノムデータは通常、<code>SummarizedExperiment</code> オブジェクトクラスに保存されます。 あなたのパッケージがそのようなデータを利用する場合は、 <code>SummarizedExperiment</code> パッケージとの相互運用を検討する必要があります。 必要に応じてあなたが組み込む必要のあるコアパッケージのリストは次のとおりです。</p>
<ul>
<li>
<a href="https://bioconductor.org/packages/GenomicRanges">GenomicRanges</a> ゲノム座標を使用する場合</li>
<li>
<a href="https://bioconductor.org/packages/SummarizedExperiment">SummarizedExperiment</a> 矩形のフィーチャ x サンプルデータを使用する場合</li>
<li>
<a href="https://bioconductor.org/packages/rtracklayer">rtracklayer</a> GTF、GFF、BED、BigWigなどをインポートする場合</li>
<li>
<a href="https://bioconductor.org/packages/GenomicAlignments">GenomicAlignments</a> SAM/BAM ファイルをインポートする場合</li>
<li>
<a href="https://bioconductor.org/packages/VariantAnnotation">VariantAnnotation</a> VCF ファイルをインポートする場合</li>
<li>
<a href="https://bioconductor.org/packages/Rsamtools">Rsamtools</a> SAM/BAM ファイルをインポートする場合</li>
<li>
<a href="https://bioconductor.org/packages/Biostrings">Biostrings</a> DNA/RNA/AA 配列を使用する場合、またはFASTAファイルをインポートする場合</li>
<li>
<a href="https://bioconductor.org/packages/ShortRead">ShortRead</a> FASTQ ファイルをインポートする場合</li>
<li>
<a href="https://bioconductor.org/packages/MSnbase">MSnbase</a> 質量分析データを使用する場合</li>
<li>
<a href="https://bioconductor.org/packages/GSEABase">GSEABase</a> 遺伝子セットを扱う場合</li>
<li>
<a href="https://bioconductor.org/packages/SingleCellExperiment">SingleCellExperiment</a> シングルセルデータを扱う場合</li>
</ul>
</div>
<div id="モジュール性" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E6%80%A7" class="anchor"></a>モジュール性</h3>
<p>Bioconductorのパッケージはモジュール式であるべきです。 つまり、あなたの関数をより小さなパーツに分割するよう心がける必要があります。 これには複数の利点があります:</p>
<ul>
<li>関数が短いほど理解しやすい</li>
<li>関数は複数の問題にわたって使用できる</li>
<li>ユーザーは中間結果を確認し、分析を調整できる</li>
</ul>
<p>特に、コードのコピー貼り付けは避けてください。 代わり行うことは、関数を記述してその関数を適用するだけです。 モジュール性と再利用性の概念は、 相互運用性と呼ばれることもあることに注意してください。</p>
</div>
<div id="再現性のある研究" class="section level3">
<h3 class="hasAnchor">
<a href="#%E5%86%8D%E7%8F%BE%E6%80%A7%E3%81%AE%E3%81%82%E3%82%8B%E7%A0%94%E7%A9%B6" class="anchor"></a>再現性のある研究</h3>
<p>あなたのパッケージのドキュメント、特にvignetteを通じて提供されるユースケースの例 はBioconductorの要です。 これにより、ユーザーはパッケージを正しく利用する方法を知ることができます。 これは、再現性のある研究と使用を可能にすることの一部です。</p>
</div>
</div>
<div id="bioconductorパッケージの作成" class="section level2">
<h2 class="hasAnchor">
<a href="#bioconductor%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E4%BD%9C%E6%88%90" class="anchor"></a>Bioconductorパッケージの作成</h2>
<p>いよいよ実践的な部分に進みます。 ここからは、RStudioが必要です。 RStudioには、エンドユーザーがパッケージの作成と配布を簡単にするためのツール がすでに追加されているため、(パッケージ作成を)始めるのに最適な場所です。</p>
<p>この教材では次のパッケージが必要です:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://usethis.r-lib.org">usethis</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lcolladotor/biocthis">biocthis</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://roxygen2.r-lib.org/">roxygen2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mangothecat/goodpractice">goodpractice</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Bioconductor/BiocCheck/issues">BiocCheck</a></span><span class="op">)</span></code></pre></div>
<div id="常にバージョン管理から始める" class="section level3">
<h3 class="hasAnchor">
<a href="#%E5%B8%B8%E3%81%AB%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%81%8B%E3%82%89%E5%A7%8B%E3%82%81%E3%82%8B" class="anchor"></a>常にバージョン管理から始める</h3>
<p>バージョン管理は、ソフトウェア開発にとって特に重要です。 これは、すべての変更を追跡する必要があるためです。誤って何かを壊した場合は、 時間を遡ってエラーを修正できます。 基本的に、バージョン管理は、 MicrosoftのWordの「変更履歴」機能のようなものと考えてください。</p>
<div id="バージョン管理の方法" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%81%AE%E6%96%B9%E6%B3%95" class="anchor"></a>バージョン管理の方法</h4>
<p>バージョン管理を行う方法は複数ありますが、デフォルトではGitになります。 Gitは、バージョン管理を容易にするソフトウェアです。 Gitは、特に複数のソフトウェア開発者間の作業を調整するために設計されています。 Gitベースのプロジェクトは、GitHub、Bitbucket、GitLabなどのクラウドベースの サービスでホストされています。 これらはGoogleドライブのようなものと考えることができますが、 より系統立っています。 これらを使用すると、プロジェクトを保存したり、他の人と作業を共有したり、 他の人が変更を加えたりすることができます。</p>
</div>
<div id="github-と-rstudio-を用いたバージョン管理は簡単" class="section level4">
<h4 class="hasAnchor">
<a href="#github-%E3%81%A8-rstudio-%E3%82%92%E7%94%A8%E3%81%84%E3%81%9F%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%81%AF%E7%B0%A1%E5%8D%98" class="anchor"></a>GitHub と RStudio を用いたバージョン管理は簡単</h4>
<p>以降ではGitHubを使用します。 GitHubを使用するには、次のものを得る・行う必要があります:</p>
<ul>
<li>GitHub のアカウント</li>
<li>ローカルマシンへのgitのインストール</li>
<li>gitとRStudioの接続</li>
</ul>
<p>GitHubやgitについてわからない場合は、 <a href="https://togotv.dbcls.jp/20180621.html">生命科学研究のためのGitHubの使い方 基本編 | TogoTV</a> を参照してください。</p>
<p>RStudioをgitに接続するには、<code>usethis</code>パッケージを使用します。 <code>usethis</code>はパッケージとプロジェクトのセットアップを自動化してくれる Rパッケージです。</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://usethis.r-lib.org/reference/use_git_config.html">use_git_config</a></span><span class="op">(</span>user.name <span class="op">=</span> <span class="st">"Jane Doe"</span>, user.email <span class="op">=</span> <span class="st">"janedoe@email.org"</span><span class="op">)</span></code></pre></div>
<p><code>Jane Doe</code>や<code>janedoe@email.org</code>はあなたのGitHubアカウント情報に 置き換えてください。</p>
</div>
</div>
<div id="さあ始めましょう" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%81%95%E3%81%82%E5%A7%8B%E3%82%81%E3%81%BE%E3%81%97%E3%82%87%E3%81%86" class="anchor"></a>さあ始めましょう</h3>
<p>これで、開始する準備がほぼ整いました。 この教材では、小さなパッケージを作成します。 これはBioconductorに提出できるパッケージではありませんが、 ここではハイスループットゲノムアプリケーションを考えるのではなく、 パッケージ開発部分に集中してください。</p>
<div id="いくつかのレイアウトパラメータを設定する" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B%E3%81%AE%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B" class="anchor"></a>いくつかのレイアウトパラメータを設定する</h4>
<p>コードが<a href="http://bioconductor.org/developers/package-guidelines/#rcode">Bioconductorが好む</a> ようフォーマットされるように、RStudioにいくつかのレイアウト設定をしましょう。 この手順は、Word文書のレイアウトパラメータを設定するようなものと考えてください。</p>
<ul>
<li>タブを4スペースに設定します。これは、メニューバーの’Tools’中の ‘Global Options…’ を選択し、’Code’パネルの’Editing’タブ内にあります。</li>
</ul>
<p><img src="figures/tab_widths.png" width="350"></p>
<ul>
<li>列幅のマーカーを80列に設定します。これは、メニューバーの’Tools’中の ’Global Options…’を選択し、’Code’パネルの’Display’タブ内にあります。 ’Show margin’チェックボックスをクリックし、’Margin column’が80に 設定されていることを確認してください。 これは、行が長すぎるかどうかを確認するのに役立ちます。</li>
</ul>
<p><img src="figures/margin.png" width="350"></p>
</div>
<div id="パッケージを初期化する" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E5%88%9D%E6%9C%9F%E5%8C%96%E3%81%99%E3%82%8B" class="anchor"></a>パッケージを初期化する</h4>
<p>あなたの最初のパッケージを作るために<code>biocthis</code>を使用します。 <code>biocthis</code>はBioconductorパッケージ作成のセットアップを自動化してくれる Bioconductorパッケージです。 この教材のために、「praiseme」という名のパッケージを作成します。 このパッケージはtempフォルダと呼ばれる一時ファイルの置き場所に作られます。 (そのファイルパスはOSによって異なります。)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pkgdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/biocthis/man/biocthis_example_pkg.html">biocthis_example_pkg</a></span><span class="op">(</span><span class="st">"praiseme"</span>, use_git <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; ✔ Creating '/tmp/RtmpzcxSDQ/praiseme/'</span>
<span class="co">#&gt; ✔ Setting active project to '/tmp/RtmpzcxSDQ/praiseme'</span>
<span class="co">#&gt; ✔ Creating 'R/'</span>
<span class="co">#&gt; ✔ Writing 'DESCRIPTION'</span>
<span class="co">#&gt; Package: praiseme</span>
<span class="co">#&gt; Title: What the Package Does (One Line, Title Case)</span>
<span class="co">#&gt; Version: 0.0.0.9000</span>
<span class="co">#&gt; Authors@R (parsed):</span>
<span class="co">#&gt;     * First Last &lt;first.last@example.com&gt; [aut, cre] (YOUR-ORCID-ID)</span>
<span class="co">#&gt; Description: What the package does (one paragraph).</span>
<span class="co">#&gt; License: `use_mit_license()`, `use_gpl3_license()` or friends to pick a</span>
<span class="co">#&gt;     license</span>
<span class="co">#&gt; Encoding: UTF-8</span>
<span class="co">#&gt; LazyData: true</span>
<span class="co">#&gt; Roxygen: list(markdown = TRUE)</span>
<span class="co">#&gt; RoxygenNote: 7.1.1</span>
<span class="co">#&gt; ✔ Writing 'NAMESPACE'</span>
<span class="co">#&gt; ✔ Setting active project to '&lt;no active project&gt;'</span>
<span class="co">#&gt; ✔ Setting active project to '/tmp/RtmpzcxSDQ/praiseme'</span></code></pre></div>
<p>このコードを実行すると新たに「praiseme」パッケージ用のRStudioのウインドウ が作られます。そのRStudioの画面を見ると、‘Files’タブに いくつかのファイルが表示されています。 これらは、パッケージを作成するために必要なファイルです (biocthisがこれらのファイルを作成しました)。 ただしいくつかのファイル(’.Rbuildignore’、‘.Rhistory’、‘praiseme.Rproj’) は 「パッケージ作成」には必要無く、パッケージ構築の管理を「支援する」ため の追加物です。 これらの追加物はGitでバージョン管理する必要はありません。</p>
</div>
<div id="パッケージについて説明する" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%AA%AC%E6%98%8E%E3%81%99%E3%82%8B" class="anchor"></a>パッケージについて説明する</h4>
<p>これで、パッケージに情報を入力していく準備が整いました。 DESCRIPTIONファイルからその入力を始めます。 このファイルには、一連のフィールドがあります。 またそのフィールドを詳細に記述していくことで、パッケージの内容がRに通知され、 機能するようになります。 ’biocthis’が生成されたDESCRIPTIONは、次のようになっているはずです。</p>
<pre><code>Package: praiseme
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R: 
    person(given = "First",
           family = "Last",
           role = c("aut", "cre"),
           email = "first.last@example.com",
           comment = c(ORCID = "YOUR-ORCID-ID"))
Description: What the package does (one paragraph).
License: `use_mit_license()`, `use_gpl3_license()` or friends to
    pick a license
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.1.1</code></pre>
<p>すでに存在するフィールドに何が入れていくべきかを説明することから始めます。 次に、そうでないフィールドのいくつかを追加することについて少し話します。</p>
<ul>
<li>Package - この文字列は、正式なパッケージ名になります。</li>
<li>Title - これは、少し長い説明を含むパッケージの名前です。</li>
<li>Version - このフィールドの初期値はカンマで4桁区切りになっていますが Bioconductorパッケージが必要とする値はカンマで3桁区切りのもの (X.Y.Z)になります。 Xはメジャーバージョンでリリースするまでは0にします。 YにはBioconductorにパッケージを提出するまでは99を入れます。 Zはパッケージに何らかの更新があった旨をBioconductorに伝える際にインクリメント するものになります。</li>
<li>Authors - パッケージに関わる人の情報を書きます。</li>
<li>Description - このパッケージが何であるかについての詳細な説明を書く場所です。 論文の要約のように考えてください。</li>
<li>License - このパッケージのライセンスが何であるかを書きます。</li>
</ul>
<p>EncodingとLazyDataのフィールドはそのままでかまいません。</p>
<p>下記はDESCRIPTIONファイルに含めることができる他のいくつかのフィールドです。 この教材の残りの部分でこれらについて検討しますが、 取り急ぎ簡単な概要を示します。</p>
<ul>
<li>Depends - パッケージの依存関係を一覧表示するためのものです。 依存するパッケージがある場合は、ここにそのリストを書きます。 そうすることで、このパッケージは依存パッケージをロードしてからロードされます。</li>
<li>Imports - このパッケージから別のパッケージにアクセスする場合に それらのパッケージをここにリストします。 このフィールドは通常、NAMESPACEファイル内のimportステートメントと組み合わせて 使用​​され、このパッケージで使用可能にする必要のある別のパッケージの関数と オブジェクトを記述します。</li>
<li>Suggests - これは、パッケージをロードして使用するために必要のない依存関係用です。 めったに使用されないけれども別のパッケージのリソースが必要、 といった関数がある場合、Suggestsが適切なオプションです。 Suggestsはその別のパッケージが必要な時に必要な場所にロードされるように、 通常 <code><a href="https://rdrr.io/r/base/library.html">require()</a></code> とともに使用されます。</li>
<li>BiocViews - これはBioconductorに固有のフィールドです。統制語彙を使用して パッケージを説明するものです。 <a href="https://www.bioconductor.org/packages/devel/BiocViews.html">ここ</a> をクリックすると、それらの使用例を確認したり、既存のものを参照したりできます。 参照する際は ‘Developers: check this box to toggle the visibility of childless biocViews.’ というチェックボックスを必ずオンにしてください。 そうすれば、完全なオントロジーを見ることができます。 <code>biocViews</code>パッケージの<code>recommendBiocViews(pkgdir)</code>関数を使用して、 パッケージの潜在的なビューを提案することもできます。</li>
</ul>
<p>これで、DESCRIPTIONファイルについて説明したので、 我々のパッケージで実際に機能するように、ファイルに下記を入力してみましょう。</p>
<pre><code>Package: praiseme
Type: Package
Title: A Package to Desseminate Praise
Version: 0.1.0
Author: Jane Doe &lt;janedoe@email.org&gt;
Maintainer: Jane Doe &lt;janedoe@email.org&gt;
Description: This package praises the user with simple functions.
License: MIT
Encoding: UTF-8</code></pre>
</div>
<div id="バージョン管理に戻る" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%81%AB%E6%88%BB%E3%82%8B" class="anchor"></a>バージョン管理に戻る</h4>
<p>パッケージに向けて最初の一歩を踏み出しました。 通常、この時点で進捗状況をGitで保存します。 これを行うには、<code>git commit</code> コマンドを使用します。 あなたの名前のイニシャルや日付を追加してファイルを バージョン管理したことがありますか? その行為は事実上コミットと同等ですが、似たファイルのコピーを 多数生み出してしまいます。 一方Gitは、単一のファイルでその変更の履歴を調査したり、元に戻すことができます。</p>
<p><img src="figures/commit.png" width="300"></p>
<p>RStudioで<code>git commit</code>を行うには、RStudioのGitペインで 保存するすべてのファイルを選択します。次に、<code>Commit</code> をクリックします。 これにより、変更に関する短いメッセージを書き込むように求められる 新しいウィンドウが開きます。 理想的には、これは変化の動機を伝えます。 プロジェクトを再訪したり、同僚が最近行った変更を理解する必要がある場合、 コミットメッセージを読んだり、コミット間の差分情報をざっと確認したりすることは、 非常に効率的な方法です。</p>
</div>
<div id="もう少しバージョン管理について" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%82%82%E3%81%86%E5%B0%91%E3%81%97%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" class="anchor"></a>もう少しバージョン管理について</h4>
<p>ここで、 コミットしたばかりの変更をオンラインのGitHubリポジトリに伝えたいと思います。 このために、GitHubのどこにパッケージを保存するかをRに伝える必要があります。 このためには、最初に新しいGitHubリポジトリを作成する必要があります。 <a href="https://github.com" class="uri">https://github.com</a> に行き、ログインできているか確認してください。</p>
<p>緑色の“New repository”ボタンをクリックします。 または、自分のプロファイルページを表示している場合は、 “Repositories”をクリックしてから、緑色の“New”ボタンをクリックします。 これにより、新しいページに移動し、リポジトリを作成できるようになります ここはあなたのパッケージのデータがリモートで保管される場所になります。 リポジトリ名に‘praiseme’と入力し、 大きな緑色のボタン“Create repository”をクリックして初期化します。</p>
<p><img src="figures/gh.png" width="500"></p>
<p>最後に、 ‘Quick setup’ のURLをコピーします。</p>
<p><img src="figures/quick_setup.png" width="500"></p>
<p>次にRStudioで、右隅のGitペインをクリックします。 そこで、「2つの紫色のボックスと白い正方形」をクリックします。 “Add remote”をクリックします。 ここにURLを貼り付け、‘Remote Name’を “origin”に設定します。 次に、“Add”をクリックします。</p>
<p><img src="figures/git_pane.png" width="300"></p>
<p>すると“New Branch”ダイアログに戻るはずです。 ブランチ名として“master”を入力し、“Sync branch with remote”がチェック されていることを確認します。 加えて“Create”をクリックします (ブランチがすでに存在している場合でも、yes で答えてください)。 次のダイアログで、“overwrite”を選択します。</p>
</div>
</div>
<div id="あなたの最初の関数" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%81%82%E3%81%AA%E3%81%9F%E3%81%AE%E6%9C%80%E5%88%9D%E3%81%AE%E9%96%A2%E6%95%B0" class="anchor"></a>あなたの最初の関数</h3>
<p>それでは、Rパッケージにコンテンツを追加しましょう。 (我々は関数をRパッケージのコンテンツと呼ぶことにします。) 関数は、Rスクリプトとして <code>R/</code> フォルダーに置きます。</p>
<div id="関数を書く" class="section level4">
<h4 class="hasAnchor">
<a href="#%E9%96%A2%E6%95%B0%E3%82%92%E6%9B%B8%E3%81%8F" class="anchor"></a>関数を書く</h4>
<p>それでは、<code>praiseme</code> という名前で最初の関数を書いてみましょう。 これを行うには、メニューバーの‘File’に移動し、 ‘New File’を選択して、‘R Script’オプションをクリックします。 これにより、エディタペインに新しいスクリプトが開きます。 関数の構文は次のようになります。</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">function_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">arg_1</span>, <span class="va">arg_2</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
    
    <span class="fu">evaluation</span><span class="op">(</span><span class="va">arg_1</span>, <span class="va">arg_2</span><span class="op">)</span>
    
<span class="op">}</span></code></pre></div>
<p>この場合、 <code>function_name</code> は関数の名前です。 関数を利用する際にはこの名前を用いて呼び出しを行います。 関数はいくつかの引数 <code>arg_1</code> と <code>arg_2</code> を取ります。 これらはプレースホルダーであり、関数が呼び出されると値が渡されます。 これらはオプションであることに注意してください。 関数本体には、関数の機能を定義するステートメントのコレクションが含まれています。 次に、関数は関数の最後の式を返します。 これは戻り値とも呼ばれます。 それでは、簡単な例を見てみましょう。</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sum_plus_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">{</span>
    
    <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="fl">1</span>
    
<span class="op">}</span>

<span class="fu">sum_plus_1</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; [1] 6</span></code></pre></div>
<p>2つの数値と1を加算する関数を作成しました。 この関数を1と4に適用すると、予想どおり6が返されます。 良い関数を書くには練習が必要ですが、いくつかの基本的なルールがあります:</p>
<ul>
<li>コードが理解しやすくなるような示唆に富む名前を付ける</li>
<li>引数にも理解しやすくなるような示唆に富む名前を付ける</li>
<li>一貫したコーディングスタイルを使用する</li>
<li>関数を小さな関数に分割する</li>
<li>コードにコメントを付ける</li>
</ul>
<p>Bioconductor固有のコードスタイルについて知りたい場合は、 この<a href="https://bioconductor.org/developers/how-to/coding-style/">リンク</a> をチェックしてください。 コードを自動的に再スタイル化する優れたRパッケージ <a href="https://cran.r-project.org/web/packages/styler/index.html">styler</a> もあります。 コードスタイルに問題が無いかどうか確認したいだけの場合は、Rパッケージ <a href="https://cran.r-project.org/web/packages/lintr/index.html">lintr</a> の方が便利です。</p>
<p>では、<code>praiseme</code> という関数を作成するときが来ました。 この関数は、ユーザーに賞賛を返します。</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">praiseme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">your_name</span><span class="op">)</span> <span class="op">{</span>
    
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">your_name</span>, <span class="st">", you are the absolute best!"</span><span class="op">)</span>
    
<span class="op">}</span></code></pre></div>
</div>
<div id="変更をコミットする" class="section level4">
<h4 class="hasAnchor">
<a href="#%E5%A4%89%E6%9B%B4%E3%82%92%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%99%E3%82%8B" class="anchor"></a>変更をコミットする</h4>
<p>関数に満足したら、変更をコミットすることを忘れないでください。 行った変更に関する短いメッセージも忘れずに。</p>
</div>
</div>
<div id="ドキュメントを追加する" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B" class="anchor"></a>ドキュメントを追加する</h3>
<p>ドキュメントは、優れたパッケージの最も重要な側面の1つです。 これがないと、ユーザーはパッケージの使用方法を知ることができません。 ドキュメントは、将来のあなた (作者が関数が何をするはずだったかを忘れることはざらにあります)や、 パッケージを拡張する開発者の役に立ちます。 Rパッケージのドキュメントには <code><a href="https://rdrr.io/r/utils/Question.html">?</a></code> や <code>help()</code> を使ってアクセスできます。 ドキュメントの実体である .Rd ファイルは <code>\man</code>フォルダーにあります。 これらは手動で作成できますが、通常は手動で作るべきではありません。 ここでは、<code>roxygen2</code> パッケージを使用して .Rd ファイルを作成する方法を 学習しましょう。 <code>roxygen2</code> は、.Rdファイルの作成を自動化する言語であると同時に、 あなたのパッケージ中のNAMESPACEファイルとDESCRIPTIONファイルの Collateフィールドを管理することもできます。</p>
<div id="ドキュメントを書く" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E6%9B%B8%E3%81%8F" class="anchor"></a>ドキュメントを書く</h4>
<p>ドキュメントの作成を開始する非常に簡単な方法があります。 ドキュメント化する関数内にカーソルを置き、 メニューバーの‘Code’に移動して、‘Insert Roxygen Skeleton’をクリックします。 これにより、<code>praiseme</code> 関数にいくつかの行が自動的に追加されます。</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Title</span>
<span class="co">#'</span>
<span class="co">#' @param your_name </span>
<span class="co">#'</span>
<span class="co">#' @return</span>
<span class="co">#' @export</span>
<span class="co">#'</span>
<span class="co">#' @examples</span>
<span class="va">praiseme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">your_name</span><span class="op">)</span><span class="op">{</span>

    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">your_name</span>, <span class="st">", you are the best!"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>あなたは <code>#'</code> で始まる新しい行があることに気付くでしょう。 これらはroxygenのコメントです。</p>
<ul>
<li>最初の文がドキュメントのタイトルになります。 これは、<code>help(praiseme)</code>を見ると表示され、各ヘルプファイルの上部に表示されます。 1行に収まる必要があります。またピリオドで終わってはいけません。</li>
<li>2番目の段落は説明です。 これはドキュメントの最初にあり、関数の機能を簡単に説明する必要があります。</li>
<li>3番目以降の段落で詳細を説明します。 これは(多くの場合長い)セクションであり、引数の説明の後に表示され、 関数の動作について詳しく説明する必要があります。</li>
</ul>
<p>すべてのオブジェクトには、タイトルと説明が必要です。詳細はオプションです。 これらの導入ブロックに加えて、ほとんどの関数には、 <code>@param</code>、<code>@examples</code>、<code>@return</code>の3つのタグがあります。 これらはスケルトンによって自動的に生成されます。 それらは以下を参照します:</p>
<ul>
<li>
<code>@param</code> は、関数の入力またはパラメーターを説明します。 説明には、パラメータのタイプ（文字列、数値ベクトルなど）の簡潔な要約と、 名前から明らかでない場合はパラメータの機能を記載する必要があります。 説明は大文字で始まり、ピリオドで終わる必要があります。 必要に応じて、複数行(または段落)にまたがることができます。 またすべてのパラメータを文書化する必要があります。</li>
<li>
<code>@examples</code> は、実際に関数を使用する方法を示す実行可能なRコードを提供します。 多くの人が最初に例を見るので、これはドキュメントの非常に重要な部分です。 サンプルコードはエラーなしで機能する必要があります。</li>
<li>
<code>@return</code> は、関数からの出力を記述します。 これは必ずしも必要ではありませんが、 関数が入力に応じて異なるタイプの出力を返す場合、 またはS3またはS4オブジェクトを返す場合はこれを書くのは良い考えです。</li>
</ul>
<p>それでは、 <code>praiseme</code> 関数のドキュメントを記入しましょう。</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Praise the user</span>
<span class="co">#'</span>
<span class="co">#' \code{praiseme} returns praise incorporating a user-specified string.</span>
<span class="co">#'</span>
<span class="co">#' @param your_name A string specifying the name of the praisee.</span>
<span class="co">#'</span>
<span class="co">#' @return A string with the praise.</span>
<span class="co">#' @export</span>
<span class="co">#'</span>
<span class="co">#' @examples</span>
<span class="co">#' praiseme("Luke")</span>
<span class="va">praiseme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">your_name</span><span class="op">)</span><span class="op">{</span>

    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">your_name</span>, <span class="st">", you are the best!"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>最後に説明する必要があるのは、roxygenのコメントの<code>@export</code>ステートメントです。 このステートメントは、今作成した関数がユーザーに使用可能であることを確認します。 Roxygen2は、この関数がエクスポートされることを示すために、 NAMESPACEにexport行を自動的に作成します。 名前空間の重要性を理解するには、以下のセクションを参照してください。</p>
<p>上記は、 ドキュメント化とNAMESPACEに関する絶対的な基本であることに注意してください。 詳細については、この<a href="http://r-pkgs.had.co.nz/man.html">リンク</a>と この<a href="http://r-pkgs.had.co.nz/namespace.html">リンク</a> を確認することを強くお勧めします。</p>
</div>
<div id="変更をコミットすることを忘れないでください" class="section level4">
<h4 class="hasAnchor">
<a href="#%E5%A4%89%E6%9B%B4%E3%82%92%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E5%BF%98%E3%82%8C%E3%81%AA%E3%81%84%E3%81%A7%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84" class="anchor"></a>変更をコミットすることを忘れないでください</h4>
<p>ドキュメントに満足したら、変更をコミットすることを忘れないでください。 行った変更に関する短いメッセージを追加します。</p>
</div>
</div>
<div id="ドキュメントを処理する" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E5%87%A6%E7%90%86%E3%81%99%E3%82%8B" class="anchor"></a>ドキュメントを処理する</h3>
<p>NAMESPACEとマニュアルページを実際に生成するには、 生成ステップを実行する必要があります。 ただし、これを可能にする前に、現在のNAMESPACEファイルを削除する必要があります。 RStudio右下隅の‘Files’ペインでNAMESPACEファイルにチェックマークを付けてから、 ‘Delete’をクリックします。 次に、NAMESPACEとマニュアルページの生成を実行します。 これを行うには、RStudio右上隅にある‘Build’ペインに移動します。 そこで‘More’を展開し、‘Configure Build Tools …’をクリックします。 これにより、‘Generate Documentation with Roxygen’の チェックボックスをオンにするための新しいウィンドウが開きます。</p>
<p><img src="figures/document.png" width="300"></p>
<p>ここで‘More’ボタンをもう一度展開すると、‘Document’オプションが表示されます。 このオプションをクリックしましょう。 これにより、<code>\man</code>フォルダーにファイルが生成されます。 それをざっと見てください。 あなたはこれがlatexで書かれていると見分けがつくかもしれません。</p>
<div id="変更をコミットすることを忘れないでください-1" class="section level4">
<h4 class="hasAnchor">
<a href="#%E5%A4%89%E6%9B%B4%E3%82%92%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E5%BF%98%E3%82%8C%E3%81%AA%E3%81%84%E3%81%A7%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84-1" class="anchor"></a>変更をコミットすることを忘れないでください</h4>
<p>これらの変更を再度コミットします。</p>
</div>
<div id="namespaceファイルについて" class="section level4">
<h4 class="hasAnchor">
<a href="#namespace%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" class="anchor"></a>NAMESPACEファイルについて</h4>
<p>NAMESPACEファイルは、 パッケージによって(エンドユーザーに)エクスポートされるオブジェクトと、 パッケージで使用できる(他のパッケージからインポートされた)オブジェクトを コントロールするために使用されます。 DESCRIPTIONファイルとは異なり、 NAMESPACEファイルは‘.dcf’ファイルではありません。 実際には、Rコードを含めるようになっています。 幸いなことに、<code>roxygen2</code>を使用してコードを文書化すると、 NAMESPACEファイルが自動的に作成されます。 これは高度なトピックであるため、 <code>roxygen2</code>を使用して自動的に生成する方法を説明する以外のことは ここでは取り上げません。 興味のある方は、この<a href="http://r-pkgs.had.co.nz/namespace.html">リンク</a> をたどってください。</p>
</div>
</div>
<div id="ビルドインストールパッケージのテスト" class="section level3">
<h3 class="hasAnchor">
<a href="#%E3%83%93%E3%83%AB%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88" class="anchor"></a>ビルド、インストール、パッケージのテスト</h3>
<p>我々はここで一旦パッケージングを終えました。 実際には、これはおそらくパッケージの書き始めであり、あとは これまで述べた下記と同じ戦略を使用して関数を追加していくだけです。</p>
<ul>
<li>関数を書く</li>
<li>関数にドキュメントをつける</li>
<li>ドキュメントとNAMESPACEファイルの作成</li>
</ul>
<p>最後に(または合間合間に)パッケージが機能するかどうかを確認する必要があります。 この場合は、パッケージがビルドされ、インストールできるかどうかを意味します。</p>
<div id="パッケージをビルドしインストールする" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B" class="anchor"></a>パッケージをビルドしインストールする</h4>
<p>まず、パッケージがビルドされるかどうかを確認しましょう。 これを行うには、RStudioの右上隅にある‘Build’ペインに移動し、 ‘More’をクリックします。 ここに‘Build Source Package’があります。 これにより、あなたのディレクトリで <a href="https://devtools.r-lib.org//reference/build.html">devtools::build()</a> が実行され、プラットフォームに依存しない、トランスポートに適した方法で、 すべてのパッケージコンテンツを含むtarファイルが作成されます。</p>
<p>次に、パッケージを実際に操作できるかどうかを確認する必要があります。 つまり、パッケージをインストールして機能を実行できるかどうかを確認します。 これを行うには、‘Build’ペインの‘Install and Restart’ボタンをクリックします。 これにより、Rsessionが再起動し、パッケージがインストールされます。 これで、関数が機能したかどうかをテストして確認できます。</p>
</div>
<div id="パッケージをテストする" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E3%83%86%E3%82%B9%E3%83%88%E3%81%99%E3%82%8B" class="anchor"></a>パッケージをテストする</h4>
<p>それでは、あなたのパッケージで遊んでみてください。 特に、ドキュメントが機能するかどうかを確認してください。 これには、コマンド<code>?praiseme</code>を使用します。</p>
<p>パッケージが最初のテストが通ったら、正式にテストできます。 パッケージをテストする方法はいくつかあります。 最も簡単な方法は、‘Build’ペインに再度移動し、‘Check’をクリックすることです。 これにより、パッケージに対して <code>R CMD check</code> が実行され、 すべての例が実行されるだけでなく、パッケージがビルドされ、 再度インストールされます。</p>
<p><a href="https://www.bioconductor.org/developers/package-guidelines/">Bioconductorのパッケージガイドライン</a> を見ると、パッケージがERRORやWARNINGなしで<code>R CMD build</code> と <code>R CMD check</code> に合格するだけでなく、 あなたのコードが他のBioconductorプロジェクトのパッケージとうまく融合するように 適切に文書化されていることも確認する必要があります。</p>
<p>コードが正常であることを確認するための その他の要件にも合格する必要があることがわかります。 文書化されており、プロジェクトの残りの部分にうまく統合されること。 次のように、 BiocCheckへの準拠についてあなたのパッケージをテストすることもできます:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Bioconductor/BiocCheck/issues">BiocCheck</a></span><span class="op">)</span>
<span class="co"># This assume your working directory is the package directory.</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocCheck/man/BiocCheck.html">BiocCheck</a></span><span class="op">(</span><span class="st">"."</span><span class="op">)</span></code></pre></div>
<p>この時点までの手順に従っている場合、上記の関数を呼び出すと、 パッケージがBioconductorパッケージガイドラインに準拠するために 必要なものを示すリストオブジェクトが出力として生成されます。 BiocCheckの出力は、次の3つの異なるカテゴリに分類されます。</p>
<ul>
<li>Requirements は、常に必要であると私たちが確信しているものです。 これらのいくつかに失敗した場合は、すぐに修正することを目指す必要があります。</li>
<li>Recommendations は、通常、変更することが非常に重要なものですが、 その解釈はコンテキストに依存する場合があります。 これらのいくつかに失敗している場合は、可能であれば修正を試みる必要があります。</li>
<li>Considerations は通常は良いアイデアです。 ただし、特定の場合に適用される場合と適用されない場合があります。</li>
</ul>
<p>最後に、別の良いアイデアは、パッケージで次のコードを実行することです:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mangothecat/goodpractice">goodpractice</a></span><span class="op">)</span>
<span class="co"># This assume your working directory is the package directory.</span>
<span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/goodpractice/man/gp.html">gp</a></span><span class="op">(</span><span class="st">"."</span><span class="op">)</span>
<span class="va">g</span></code></pre></div>
<p>これは、あなたのパッケージに合わせた Rパッケージを構築する際のグッドプラクティスに関するアドバイスを提供する <code>goodpractice</code> パッケージを利用しています。 アドバイスには、避けるべき関数と構文、パッケージ構造、コードの複雑さ、 コードのフォーマットなどが含まれます。</p>
</div>
</div>
<div id="同様に必要とされることただしこの教材ではカバーされていないこと" class="section level3">
<h3 class="hasAnchor">
<a href="#%E5%90%8C%E6%A7%98%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%A8%E3%81%95%E3%82%8C%E3%82%8B%E3%81%93%E3%81%A8%E3%81%9F%E3%81%A0%E3%81%97%E3%81%93%E3%81%AE%E6%95%99%E6%9D%90%E3%81%A7%E3%81%AF%E3%82%AB%E3%83%90%E3%83%BC%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8" class="anchor"></a>同様に必要とされること(ただしこの教材ではカバーされていないこと)</h3>
<p>パッケージには、Bioconductorにとって重要で必要な他のパーツいくつかありますが、 ここでは説明しません。 これらを簡単に紹介してから、リンクを参照して詳細を確認します。</p>
<div id="vignette" class="section level4">
<h4 class="hasAnchor">
<a href="#vignette" class="anchor"></a>Vignette</h4>
<p>Vignette(ビネット)は、パッケージの長い形式のガイドです。 関数のドキュメントは、必要な関数の名前がわかっている場合は便利ですが、 それ以外の場合は役に立ちません。 ビネットは、本の章や学術論文のようなものです。 パッケージが解決するように設計されている問題を説明し、 それを解決する方法を読者に示すことができます。 ビネットは、機能を有用なカテゴリに分割し、 問題を解決するために複数の関数をコーディネートする方法を示す必要があります。 ビネットの詳細については、この<a href="https://r-pkgs.org/vignettes.html">リンク</a> にアクセスしてください。</p>
</div>
<div id="ユニットテスト" class="section level4">
<h4 class="hasAnchor">
<a href="#%E3%83%A6%E3%83%8B%E3%83%83%E3%83%88%E3%83%86%E3%82%B9%E3%83%88" class="anchor"></a>ユニットテスト</h4>
<p>これらは自動化されたテストであり、 パッケージを初めてインストールするときに実行するテストに少し似ています。 ただし、あなたがこれらを実行する代わりに、コンピューターが処理します。 これには、これらのテストの実行方法をコンピューターに指示する必要があります。 これは、<code>\tests</code>フォルダーにある単体テストを作成する場合に、あなたが行うこと になります。 この目的のためにはRパッケージ<code>testthat</code>が必要になります。 詳細を知りたい場合は、この<a href="https://r-pkgs.org/tests.html">リンク</a> をたどってください。</p>
</div>
<div id="newsファイル" class="section level4">
<h4 class="hasAnchor">
<a href="#news%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB" class="anchor"></a>NEWSファイル</h4>
<p><code>NEWS.md</code>ファイルは、既存のユーザーを対象としています。 各リリースでのすべてのAPIの変更を一覧表示する必要があります。 パッケージニュースに使用できる形式はいくつかありますが、 <code>NEWS.md</code>をお勧めします。 GitHubで十分にサポートされており、CRANで許可されており、 他の形式で簡単に再利用できます。 NEWSファイルの詳細については、この<a href="http://r-pkgs.had.co.nz/release.html">リンク</a> にアクセスしてください。</p>
</div>
<div id="github-actions" class="section level4">
<h4 class="hasAnchor">
<a href="#github-actions" class="anchor"></a>Github actions</h4>
<p>Github actionsを使用すると、 変更をコミットするたびに、パッケージングに関するチェックを 自動的に行うことができます。 これにより、エラーをすばやくキャッチできます。 ただし、設定が難しい場合があります。 大変な作業を行うパッケージの場合これを使うのは良いことです。 <code>biocthis</code>の助けを借りるとGithub actionsを簡単に追加できます。 詳細については、<code>biocthis</code>の関数<code><a href="https://rdrr.io/pkg/biocthis/man/use_bioc_github_action.html">use_bioc_github_action()</a></code>を確認してください。</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kozo Nishida.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
